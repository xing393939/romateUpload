<!doctype html>
<html>
<head>
    <title>SHA1 Checksum Calculator</title>
</head>
<body>
<script>
    var worker;
    function fileSlice(file, start, length) {
        var end = length + start;
        if (file.mozSlice) {
            return file.mozSlice(start, end);
        } else if (file.webkitSlice) {
            return file.webkitSlice(start, end);
        } else {
            return file.slice(start, end);
        }
    }

    function selected(file) {
        if (worker) worker.terminate();
        var size = file.size;
        var realsize = Math.ceil((size / 4 + 3) / 16) * 16 * 4;
        worker = new Worker('js-typed-array-sha1.js');
        lasttime = +new Date;
        lastprocessed = 0;
        worker.onmessage = function (e) {
            if (e.data.action == 'requestChunk') {
                //Firefox doesn't support FileReader inside WebWorkers
                var fr = new FileReader();
                fr.onload = function () {
                    worker.postMessage(fr.result);
                }
                fr.readAsArrayBuffer(fileSlice(file, e.data.position, e.data.amount));
            } else {
                console.log(e.data.hash);
            }
        }
        worker.onerror = function (e) {
            console.log(e);
        }
        worker.postMessage({file: file, size: size});
    }
</script>
<div id="floater">
    <input type="file" onchange="selected(this.files[0])">
</div>
</body>
</html>



